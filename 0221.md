# 0221
## 0103進度
## 後端開始
### npm init --yes
### 加"type":"module"
### 改"dev":"nodemon index.js","start":"node index.js"
### npm i -D eslint nodemon
### F1 create eslint
### 改eslint版本12
### 建立 .gitignore
    node_modules
    .env
## 提示如果只開一個vscode時
    前後端放在一起
    在back裡面
    eslint要自己打
    npm i -D eslint 不會跳選項
    路徑問題eslint 會失效
    要在cmd打
    node_modules\.bin\eslint -- init
    這樣eslint才會跳選項
---
# 安裝套件
    npm i express mongoose dotenv jsonwebtoken multer cloudinary multer-storage-cloudinary md5 validator cors
---
# 先從models開始
## 新增資料夾models/users.js
## 寫資料架構， Schema = 架構
## imp + tab 可以快速 import
```js
import mongoose from 'mongoose'
import md5 from 'md5'
import validator from 'validator'

const userSchema = new mongoose.Schema({
  account: {
    type: String,
    minlength: [4, '帳號必須 4 個字以上'],
    maxlength: [20, '帳號必須 20 個字以下'],
    unique: true,
    required: [true, '帳號不能為空']
  },
  password: {
    type: String,
    required: [true, '密碼不能為空']
  },
  email: {
    type: String,
    required: [true, '信箱不能為空'],
    unique: true,
    validate: {
      validator (email) {
        return validator.isEmail(email)
      },
      message: '信箱格式不正確'
    }
  },
  role: {
    // 0 = 一般會員
    // 1 = 管理員
    type: Number,
    default: 0
  },
  tokens: {
    type: [String]
  },
  cart: {
    type: [
      {
        product: {
          type: mongoose.ObjectId,
          ref: 'products',
          required: [true, '缺少商品 ID']
        },
        quantity: {
          type: Number,
          required: [true, '缺少商品數量']
        }
      }
    ]
  }
}, { versionKey: false })

userSchema.pre('save', function (next) {
  // this 代表要寫進去的資料
  const user = this
  if (user.isModified('password')) {
    if (user.password.length >= 4 && user.password.length <= 20) {
      user.password = md5(user.password)
    } else {
      const error = new mongoose.Error.ValidationError(null)
      error.addError('password', new mongoose.Error.ValidatorError({ message: '密碼長度錯誤' }))
      next(error)
      return
    }
  }
  next()
})

userSchema.pre('findOneAndUpdate', function (next) {
  // user代表更新的資料
  const user = this._update
  if (user.password) {
    if (user.password.length >= 4 && user.password.length <= 20) {
      user.password = md5(user.password)
    } else {
      const error = new mongoose.Error.ValidationError(null)
      error.addError('password', new mongoose.Error.ValidatorError({ message: '密碼長度錯誤' }))
      next(error)
      return
    }
  }
  next()
})

export default mongoose.model('users', userSchema)
```
## 創models/products.js
```js
import mongoose from 'mongoose'

const productSchema = new mongoose.Schema({
  name: {
    type: String,
    required: [true, '商品名不能為空']
  },
  price: {
    type: Number,
    min: [0, '價格格式不正確'],
    required: [true, '商品價格不能為空']
  },
  description: {
    type: String
  },
  image: {
    type: String
  },
   // 是否上架
  sell: {
    type: Boolean,
    default: false
  },
  // 商品的分類(靜態固定那幾類)
  category: {
    type: String,
    //  enum 值只能是陣列裡的類別
    enum: {
      values: ['飾品', '皮件', '鞋子'],
      message: '商品分類不存在'
    }
  }
}, { versionKey: false })

export default mongoose.model('products', productSchema)
```
## 創models/orders.js
```js
import mongoose from 'mongoose'

// 訂單
const orderSchema = new mongoose.Schema({
  user: {
    type: mongoose.ObjectId,
    // ref代表這個欄位的資料是users來的
    ref: 'users'
  },
  products: {
    type: [
      {
        product: {
          type: mongoose.ObjectId,
          ref: 'products',
          required: [true, '缺少商品 ID']
        },
        quantity: {
          type: Number,
          required: [true, '缺少商品數量']
        }
      }
    ]
  },
  date: {
    type: Date,
    default: Date.now
  }
}, { versionKey: false })

export default mongoose.model('orders', orderSchema)
```
---
# index.js 是主要檔案
## 在外層創一個 index.js
```js
import 'dotenv/config'
import express from 'express'
import mongoose from 'mongoose'
import cors from 'cors'

       // .env很重要，因為要隱藏帳密
mongoose.connect(process.env.DB_URL, () => {
  console.log('MongoDB Connected')
})

const app = express()

// 允許前端發跨域請求
app.use(cors({
  origin (origin, callback) {
    // origin === undefined => postman才可以過
    if (origin === undefined || origin.includes('github') || origin.includes('localhost')) {
      callback(null, true)
    } else {
      callback(new Error('Not allowed'), false)
    }
  }
}))
// 接上一個的錯誤，callback(new Error('Not allowed'), false)
app.use((_, req, res, next) => {
  res.status(403).send({ success: false, message: '請求被拒絕' })
})
// 解析json請求
app.use(express.json())
// 解析json的錯誤
app.use((_, req, res, next) => {
  res.status(400).send({ success: false, message: '資料格式錯誤' })
})

app.all('*', (req, res) => {
  res.status(404).send({ success: false, message: '找不到' })
})

app.listen(process.env.PORT || 3000, () => {
  console.log('Server Started')
})
```
---
# 再來是路由
## 創routes/users.js
```js
import express from 'express'
import {
  register
} from '../controllers/users.js'

const router = express.Router()

router.post('/', register)

export default router
```
## 寫功能，創controllers/users.js
```js
import users from '../models/users.js'

export const register = async (req, res) => {
  if (!req.headers['content-type'] || !req.headers['content-type'].includes('application/json')) {
    res.status(400).send({ success: false, message: '資料格式不正確' })
    return
  }
  try {
    await users.create(req.body)
    res.status(200).send({ success: true, message: '' })
  } catch (error) {
    if (error.name === 'ValidationError') {
      const key = Object.keys(error.errors)[0]
      res.status(400).send({ success: false, message: error.errors[key].message })
    } else if (error.name === 'MongoServerError' && error.code === 11000) {
      res.status(400).send({ success: false, message: '帳號已存在' })
    } else {
      res.status(500).send({ success: false, message: '伺服器錯誤' })
    }
  }
}
```
## 順序概念
## models 被引入到 controllers 被引入到 routes 被引入到 index.js
## 通常寫的順序
## models 然後 index.js  然後 routes 然後 controllers 然後 引入到index.js
## 建立.env
    DB_URL= (moogonDB複製) /text5
## 在index.js引入路由
```js
import usersRouter from './routes/users.js'
app.use('/users', usersRouter) // =>引入在app.all('*', (req, res) 上面
```
---
# 前端
## vue create final
## 選項除了下二跟typescript沒選
## 創完，開啟新建的 final 資料夾
---
# 前端
## vue add vuetify
## 選 default
## 改script
    "scripts": {
        "serve": "SET NODE_OPTIONS=--openssl-legacy-provider && vue-cli-service serve",
        "build": "SET NODE_OPTIONS=--openssl-legacy-provider && vue-cli-service build",
        "lint": "SET NODE_OPTIONS=--openssl-legacy-provider && vue-cli-service lint",
        "serve-linux": "export SET NODE_OPTIONS=--openssl-legacy-provider; vue-cli-service serve",
        "build-linux": "export SET NODE_OPTIONS=--openssl-legacy-provider; vue-cli-service build",
        "lint-linux": "export SET NODE_OPTIONS=--openssl-legacy-provider; vue-cli-service lint"
      },
## npm run serve 試試
## 功能正常，灌一些套件，做一些設置
## npm i -D pug pug-plain-loader
## npm i axios vue-axios vue-sweetalert2
---
## 把APP.vue 清空寫一寫簡單設置
```html
<template lang="pug">
v-app
  Navbar
  v-main
    router-view
</template>

<script>
import Navbar from './components/Navbar.vue'

export default {
  name: 'App',
  component: {
    Navbar
  }
}
</script>
```
## 引入Navbar元件，在component新建Navbar.vue，寫基本架構，刪掉Helloworld.vue
```html
<template lang="pug">
v-app
</template>

<script>
export default {
  name: 'Navbar',

  data: () => ({

  })
}
</script>
```
## views的Home.vue跟About.vue也只寫基本架構
---
# 先寫路由router/index.js
## webpackChunkName要記得改，打包有差
```js
import Vue from 'vue'
import VueRouter from 'vue-router'
import Home from '../views/Home.vue'

Vue.use(VueRouter)

const routes = [
  {
    path: '/',
    name: 'Home',
    component: Home,
    meta: {
      title: '拉麵號'
    }
  },
  {
    path: '/about',
    name: 'About',
    // route level code-splitting
    // this generates a separate chunk (about.[hash].js) for this route
    // which is lazy-loaded when the route is visited.
    component: () => import(/* webpackChunkName: "about" */ '../views/About.vue'),
    meta: {
      title: '拉麵號 | 品牌介紹'
    }
  },
  {
    path: '/shop',
    name: 'Shop',
    // route level code-splitting
    // this generates a separate chunk (about.[hash].js) for this route
    // which is lazy-loaded when the route is visited.
    component: () => import(/* webpackChunkName: "shop" */ '../views/Shop.vue'),
    meta: {
      title: '拉麵號 | 網路商城'
    }
  },
  {
    path: '/product',
    name: 'Product',
    // route level code-splitting
    // this generates a separate chunk (about.[hash].js) for this route
    // which is lazy-loaded when the route is visited.
    component: () => import(/* webpackChunkName: "product" */ '../views/Product.vue'),
    meta: {
      title: '拉麵號 | 商品'
    }
  },
  {
    path: '/menu',
    name: 'Menu',
    // route level code-splitting
    // this generates a separate chunk (about.[hash].js) for this route
    // which is lazy-loaded when the route is visited.
    component: () => import(/* webpackChunkName: "menu" */ '../views/Menu.vue'),
    meta: {
      title: '拉麵號 | 菜單'
    }
  },
  {
    path: '/login',
    name: 'Login',
    // route level code-splitting
    // this generates a separate chunk (about.[hash].js) for this route
    // which is lazy-loaded when the route is visited.
    component: () => import(/* webpackChunkName: "login" */ '../views/Login.vue'),
    meta: {
      title: '拉麵號 | 登入'
    }
  },
  {
    path: '/register',
    name: 'Register',
    // route level code-splitting
    // this generates a separate chunk (about.[hash].js) for this route
    // which is lazy-loaded when the route is visited.
    component: () => import(/* webpackChunkName: "register" */ '../views/Register.vue'),
    meta: {
      title: '拉麵號 | 註冊'
    }
  },
  {
    path: '/cart',
    name: 'Cart',
    // route level code-splitting
    // this generates a separate chunk (about.[hash].js) for this route
    // which is lazy-loaded when the route is visited.
    component: () => import(/* webpackChunkName: "cart" */ '../views/Cart.vue'),
    meta: {
      title: '拉麵號 | 購物車'
    }
  }
]

const router = new VueRouter({
  routes
})

// 跳頁上面會改成跳轉後的名稱
router.afterEach((to, from) => {
  document.title = to.meta.title
})

export default router

```
## 在views/新增，路徑要的vue
    * ../views/Cart.vue in ./src/router/index.js
    * ../views/Login.vue in ./src/router/index.js
    * ../views/Menu.vue in ./src/router/index.js
    * ../views/Product.vue in ./src/router/index.js
    * ../views/Shop.vue in ./src/router/index.js
    * ../views/Register.vue in ./src/router/index.js
## views裡的Vue都寫基本架構
```html
<template lang="pug">
v-app
</template>

<script>

export default {
  name: 'Shop',

  components: {
  }
}
</script>
```
---
## 先寫components的Navbar.vue
## 把Navbar.vue 刪掉了
## 直接把navbar 寫在 APP.vue
# App.vue
```html
<template >
<v-app>
  <v-app-bar color="red" height="110">
    <router-link class="logo" to="/">
      <div class="navbar_logo">
      <img src="~./assets/logo_nav.png"  alt="logo" contain height="100"/>
      </div>
    </router-link>
    <template>
      <v-tabs
      background-color="deep-red"
      center-active
      centered
      dark
      >
        <v-tab  to="/"><h2>首頁</h2></v-tab>
        <v-tab  to="/about"><h2>品牌介紹</h2></v-tab>
        <v-tab to="/menu"><h2>菜單</h2></v-tab>
        <v-tab to="/shop"><h2>網路商城</h2></v-tab>
        <v-tab to="/product"><h2>商品</h2></v-tab>
        <v-tab to="/register"><h2>註冊</h2></v-tab>
        <v-tab to="/login"><h2>登入</h2></v-tab>
        <v-tab to="/cart"><h2>購物車</h2></v-tab>
      </v-tabs>
    </template>
  </v-app-bar>
  <router-view></router-view>
</v-app>
</template>

<script>

export default {
  name: 'App',
  component: {
  }
}
</script>

```
## 寫Home.vue
```html
<template >
<v-app >
  <!-- 投影片 --------------------------------------------------------->
  <v-carousel
    cycle
    height="800"
    hide-delimiter-background
    show-arrows-on-hover
  >
    <v-carousel-item
      v-for="(item,i) in items"
      :key="i"
      :src="item.src"
    >
    </v-carousel-item>
  </v-carousel>
  <!-- 投影片 --------------------------------------------------------->
  <!-- 品牌介紹 ------------------------------------------------------->
  <v-container style="background-color:rgb(253, 236, 0); flex-direction: column;" class="d-flex justify-center align-center">
    <div class="d-flex justify-center">
    <img src="../assets/logo.png" alt="logo" width="100px">
    <h1 style="text-align: center; margin-top: 30px; font-size: 50px;">品牌介紹</h1>
    </div>
    <v-row class="justify-center mt-3 pt-5" style="background-color:rgb(255, 255, 255); width: 90%;">
      <v-col cols="4">
        <img src="../assets/know001.png" style="object-fit: cover;">
      </v-col>
      <v-col cols="5" style="font-size: 20px; font-weight: 600;">
        <p>一九八一年創立於九州熊本，已遷到東京的總社專注多種餐飲業的經營，以美味及創新為企業宗旨，除了拉麵以外，無論是引領風潮的新式漢堡，或是被評為全東京第一名的日式煎餃，都創造出新的美食型態！

具有部份台灣血統的現任代表取締役坂田健先生賦與台灣分公司的唯一使命，就是將純正日本美食帶到台灣！希望這個分公司能擁有台灣人開創進取的精神，加上日本職人的堅持態度。

樂麵屋是由日本總公司直接在台灣所創立經營，有別於本地的公司代理日本既有拉麵品牌。建立直營的新品牌目的在於能夠即時以日本的標準直接管控餐點品質，同時不需背負既有品牌的限制，更能提出創新的做法及口味！這也是為什麼每個樂麵屋的分店都有不同的裝潢，氣氛及不同口味的特色拉麵，因為我們痛恨重複，創新求變和追求美味是根植在我們的基因裏的啊！</p>
      </v-col>
    </v-row>
    <v-row>
      <v-col cols="12">
        <v-btn color="red" height="60" to="/about">
          <h2 style="color: white;">了解更多</h2>
        </v-btn>
      </v-col>
      </v-row>
  </v-container>
  <!-- 品牌介紹 ------------------------------------------------------->
  <!-- 菜單    ------------------------------------------------------->
  <v-container style="background-color:rgb(253, 236, 0); flex-direction: column;" class="d-flex justify-center align-center">
    <div class="d-flex justify-center">
    <img src="../assets/logo.png" alt="logo" width="100px">
    <h1 style="text-align: center; margin-top: 30px; font-size: 50px;">菜單</h1>
    </div>
    <v-row class="justify-center mt-3 pt-5" style="background-color:rgb(255, 255, 255); width: 90%;">
      <v-col cols="3">
        <v-card
          class="justify-center d-flex flex-column align-center"
          max-width="400">
          <v-img
          src="https://images.unsplash.com/photo-1623341214825-9f4f963727da?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxzZWFyY2h8MXx8cmFtZW58ZW58MHwwfDB8fA%3D%3D&auto=format&fit=crop&w=500&q=60"
          height="200px"
          ></v-img>

          <v-card-title>
            <h2>豚骨拉麵</h2>
          </v-card-title>

      <v-card-text class="mx-auto justify-center d-flex flex-column align-center">
        <h3>黯然消魂的豚骨，最經典口味</h3>
      </v-card-text>

  </v-card>
      </v-col>
      <v-col cols="3">
        <v-card
          class="justify-center d-flex flex-column align-center"
          max-width="400">
          <v-img
          src="https://images.unsplash.com/photo-1591814468924-caf88d1232e1?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxzZWFyY2h8Mnx8cmFtZW58ZW58MHwwfDB8fA%3D%3D&auto=format&fit=crop&w=500&q=60"
          height="200px"
          ></v-img>

          <v-card-title>
            <h2>泡菜拉麵</h2>
          </v-card-title>

      <v-card-text class="justify-center d-flex flex-column align-center">
        <h3>來自韓國的泡菜，阿你唷say唷</h3>
      </v-card-text>

  </v-card>
      </v-col><v-col cols="3">
        <v-card
          class="justify-center d-flex flex-column align-center"
          max-width="400">
          <v-img
          src="https://images.unsplash.com/photo-1618889482923-38250401a84e?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxzZWFyY2h8M3x8cmFtZW58ZW58MHwwfDB8fA%3D%3D&auto=format&fit=crop&w=500&q=60"
          height="200px"
          ></v-img>

          <v-card-title>
            <h2>雞白湯拉麵</h2>
          </v-card-title>

      <v-card-text class="mx-auto justify-center d-flex flex-column align-center">
        <h3>24小時舒肥雞肉，加上完美熬煮的雞湯</h3>
      </v-card-text>

  </v-card>
      </v-col>
    </v-row>
    <v-row>
      <v-col cols="12">
        <v-btn color="red" height="60" to="/menu">
          <h2 style="color: white;">更多餐點</h2>
        </v-btn>
      </v-col>
      </v-row>
  </v-container>
  <!-- 菜單    ------------------------------------------------------->

</v-app>
</template>

<script>

export default {
  name: 'Home',
  data () {
    return {
      items: [
        {
          src: 'https://images.unsplash.com/photo-1623341214825-9f4f963727da?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxzZWFyY2h8MXx8cmFtZW58ZW58MHwwfDB8fA%3D%3D&auto=format&fit=crop&w=500&q=60'
        },
        {
          src: 'https://images.unsplash.com/photo-1591814468924-caf88d1232e1?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxzZWFyY2h8Mnx8cmFtZW58ZW58MHwwfDB8fA%3D%3D&auto=format&fit=crop&w=500&q=60'
        },
        {
          src: 'https://images.unsplash.com/photo-1618889482923-38250401a84e?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxzZWFyY2h8M3x8cmFtZW58ZW58MHwwfDB8fA%3D%3D&auto=format&fit=crop&w=500&q=60'
        },
        {
          src: 'https://images.unsplash.com/photo-1632440722549-692fc6af969e?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxzZWFyY2h8Nnx8cmFtZW58ZW58MHwwfDB8fA%3D%3D&auto=format&fit=crop&w=500&q=60'
        }
      ]
    }
  },

  components: {
  }
}
</script>

```
## 寫Footer.vue
```html
<template>
  <v-footer style="background-color:rgb(63, 62, 62);">
    <v-row class="justify-center">
      <v-col cols="2" class="d-flex justify-end">
        <img src="../assets/logo.png" alt="logo" width="100px">
      </v-col>
      <v-col class="d-flex justify-center flex-column" cols="2" style="color: white;">
        <h2 style="color: white; padding-top:20px; padding-left: 60px;">麵屋號</h2>
        <p>Email:ramen666@ramen.com</p>
      </v-col>
    </v-row>
      <v-col class="text-center footer mt-2" cols="12" style="color: white;">
        Copyright © {{ new Date().getFullYear() }} <strong>純粹學習使用</strong>. All
        rights reserved. 版權所有© {{ new Date().getFullYear() }}
      </v-col>
    </v-footer>
</template>

<script>

export default {
  name: 'Footer',

  components: {
  }
}
</script>

```
## About.vue
```html
<template>
<v-app>
<!-- 品牌介紹 ------------------------------------------------------->
  <v-container style="background-color:rgb(253, 236, 0); flex-direction: column;" class="d-flex justify-center align-center">
    <div class="d-flex justify-center">
    <img src="../assets/logo.png" alt="logo" width="100px">
    <h1 style="text-align: center; margin-top: 30px; font-size: 50px;">麵屋號</h1>
    </div>
    <v-row class="justify-center mt-5 pt-5" style="background-color:rgb(255, 255, 255); width: 90%;">
      <v-col cols="4">
        <img src="../assets/know002.png" style="object-fit: cover;">
      </v-col>
      <v-col cols="5" style="font-size: 20px; font-weight: 600;">
        <h1>源自博多‧正統豚骨拉麵</h1>
        <p>

源自日本九州福岡拉麵之都「博多」的一風堂，由享譽國際的神級拉麵大王河原成美創辦，至今除了日本外，也擴展至國際大都會包括紐約、新加坡、雪梨、巴黎、香港和上海等地設立分店，全球店鋪數超過200家。

創辦人河原成美多年來雄踞人氣拉麵店榜首，在1995年至1998年間，TV Tokyo製作的《TV Champion─拉麵職人選手權》中，連續贏得三屆冠軍。河原成美更於2005年榮獲「拉麵王」的美譽，在拉麵名人堂中獲得殿堂級席位。

一風堂秉持著「堅持傳統、持續創新」的宗旨，選用上乘食材，配以正宗日本傳統烹調技法，並以顏色區分湯底，創造出最經典的兩款拉麵「赤丸新味」及「白丸元味」，此舉旋即成為業界的指標，各拉麵店均爭相仿效。</p>
      </v-col>
    </v-row>
    <div class="d-flex justify-center mt-5">
    <img src="../assets/logo.png" alt="logo" width="100px">
    <h1 style="text-align: center; margin-top: 30px; font-size: 50px;">品牌介紹</h1>
    </div>
    <v-row class="justify-center mt-5 pt-5" style="background-color:rgb(255, 255, 255); width: 90%;">
      <v-col cols="4">
        <img src="../assets/know001.png" style="object-fit: cover;">
      </v-col>
      <v-col cols="5" style="font-size: 20px; font-weight: 600;">
        <p>一九八一年創立於九州熊本，已遷到東京的總社專注多種餐飲業的經營，以美味及創新為企業宗旨，除了拉麵以外，無論是引領風潮的新式漢堡，或是被評為全東京第一名的日式煎餃，都創造出新的美食型態！

具有部份台灣血統的現任代表取締役坂田健先生賦與台灣分公司的唯一使命，就是將純正日本美食帶到台灣！希望這個分公司能擁有台灣人開創進取的精神，加上日本職人的堅持態度。

樂麵屋是由日本總公司直接在台灣所創立經營，有別於本地的公司代理日本既有拉麵品牌。建立直營的新品牌目的在於能夠即時以日本的標準直接管控餐點品質，同時不需背負既有品牌的限制，更能提出創新的做法及口味！這也是為什麼每個樂麵屋的分店都有不同的裝潢，氣氛及不同口味的特色拉麵，因為我們痛恨重複，創新求變和追求美味是根植在我們的基因裏的啊！</p>
      </v-col>
    </v-row>

  </v-container>
  <!-- 品牌介紹 ------------------------------------------------------->
  </v-app>
</template>

<script>

export default {
  name: 'About',

  components: {
  }
}
</script>

```
## Menu.vue
```html
<template>
<v-app>
<v-container style="background-color:rgb(253, 236, 0); flex-direction: column;" class="d-flex justify-center align-center">
  <div class="d-flex justify-center">
    <img src="../assets/logo.png" alt="logo" width="100px">
    <h1 style="text-align: center; margin-top: 30px; font-size: 50px;">菜單</h1>
    </div>
    <h1>豚骨拉麵</h1>
    <v-row class="justify-center mt-3 pt-5" style="background-color:rgb(255, 255, 255); width: 90%;">
      <v-col cols="3">
        <v-card
          class="justify-center d-flex flex-column align-center"
          max-width="400">
          <v-img
          src="https://images.unsplash.com/photo-1623341214825-9f4f963727da?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxzZWFyY2h8MXx8cmFtZW58ZW58MHwwfDB8fA%3D%3D&auto=format&fit=crop&w=500&q=60"
          height="200px"
          ></v-img>

          <v-card-title>
            <h2>豚骨拉麵</h2>
          </v-card-title>

      <v-card-text class="mx-auto justify-center d-flex flex-column align-center">
        <h3>黯然消魂的豚骨，最經典口味</h3>
      </v-card-text>

  </v-card>
      </v-col>
      <v-col cols="3">
        <v-card
          class="justify-center d-flex flex-column align-center"
          max-width="400">
          <v-img
          src="https://images.unsplash.com/photo-1591814468924-caf88d1232e1?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxzZWFyY2h8Mnx8cmFtZW58ZW58MHwwfDB8fA%3D%3D&auto=format&fit=crop&w=500&q=60"
          height="200px"
          ></v-img>

          <v-card-title>
            <h2>泡菜拉麵</h2>
          </v-card-title>

      <v-card-text class="justify-center d-flex flex-column align-center">
        <h3>來自韓國的泡菜，阿你唷say唷</h3>
      </v-card-text>

  </v-card>
      </v-col><v-col cols="3">
        <v-card
          class="justify-center d-flex flex-column align-center"
          max-width="400">
          <v-img
          src="https://images.unsplash.com/photo-1618889482923-38250401a84e?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxzZWFyY2h8M3x8cmFtZW58ZW58MHwwfDB8fA%3D%3D&auto=format&fit=crop&w=500&q=60"
          height="200px"
          ></v-img>

          <v-card-title>
            <h2>雞白湯拉麵</h2>
          </v-card-title>

      <v-card-text class="mx-auto justify-center d-flex flex-column align-center">
        <h3>24小時舒肥雞肉，加上完美熬煮的雞湯</h3>
      </v-card-text>

  </v-card>
      </v-col>
    </v-row>
    <v-row class="justify-center mt-3 pt-5" style="background-color:rgb(255, 255, 255); width: 90%;">
      <v-col cols="3">
        <v-card
          class="justify-center d-flex flex-column align-center"
          max-width="400">
          <v-img
          src="https://images.unsplash.com/photo-1590579670545-bfbb5b038f86?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxzZWFyY2h8NzV8fHJhbWVufGVufDB8MHwwfHw%3D&auto=format&fit=crop&w=500&q=60"
          height="200px"
          ></v-img>

          <v-card-title>
            <h2>醬油豚骨拉麵</h2>
          </v-card-title>

      <v-card-text class="mx-auto justify-center d-flex flex-column align-center">
        <h3>黯然消魂的豚骨，醬油口味</h3>
      </v-card-text>

  </v-card>
      </v-col>
      <v-col cols="3">
        <v-card
          class="justify-center d-flex flex-column align-center"
          max-width="400">
          <v-img
          src="https://images.unsplash.com/photo-1637024696628-02cb19cc1829?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxzZWFyY2h8NjV8fHJhbWVufGVufDB8MHwwfHw%3D&auto=format&fit=crop&w=500&q=60"
          height="200px"
          ></v-img>

          <v-card-title>
            <h2>泡菜豚骨拉麵</h2>
          </v-card-title>

      <v-card-text class="justify-center d-flex flex-column align-center">
        <h3>來自韓國的泡菜，加上豚骨絕配</h3>
      </v-card-text>

  </v-card>
      </v-col><v-col cols="3">
        <v-card
          class="justify-center d-flex flex-column align-center"
          max-width="400">
          <v-img
          src="https://images.unsplash.com/photo-1635379511574-bc167ca085c8?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxzZWFyY2h8NjN8fHJhbWVufGVufDB8MHwwfHw%3D&auto=format&fit=crop&w=500&q=60"
          height="200px"
          ></v-img>

          <v-card-title>
            <h2>蝦高湯拉麵</h2>
          </v-card-title>

      <v-card-text class="mx-auto justify-center d-flex flex-column align-center">
        <h3>完美熬煮的蝦湯，鮮味十足</h3>
      </v-card-text>

  </v-card>
      </v-col>
    </v-row>
    <v-row class="justify-center mt-3 pt-5" style="background-color:rgb(255, 255, 255); width: 90%;">
      <v-col cols="3">
        <v-card
          class="justify-center d-flex flex-column align-center"
          max-width="400">
          <v-img
          src="https://images.unsplash.com/photo-1558920558-fb0345e52561?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxzZWFyY2h8NTR8fHJhbWVufGVufDB8MHwwfHw%3D&auto=format&fit=crop&w=500&q=60"
          height="200px"
          ></v-img>

          <v-card-title>
            <h2>鮮蔥豚骨拉麵</h2>
          </v-card-title>

      <v-card-text class="mx-auto justify-center d-flex flex-column align-center">
        <h3>黯然消魂的豚骨，滿滿的青蔥</h3>
      </v-card-text>

  </v-card>
      </v-col>
      <v-col cols="3">
        <v-card
          class="justify-center d-flex flex-column align-center"
          max-width="400">
          <v-img
          src="https://images.unsplash.com/photo-1569562211093-4ed0d0758f12?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxzZWFyY2h8NTN8fHJhbWVufGVufDB8MHwwfHw%3D&auto=format&fit=crop&w=500&q=60"
          height="200px"
          ></v-img>

          <v-card-title>
            <h2>3倍叉燒拉麵</h2>
          </v-card-title>

      <v-card-text class="justify-center d-flex flex-column align-center">
        <h3>3倍叉燒，3倍滿足</h3>
      </v-card-text>

  </v-card>
      </v-col><v-col cols="3">
        <v-card
          class="justify-center d-flex flex-column align-center"
          max-width="400">
          <v-img
          src="https://images.unsplash.com/photo-1552611052-60b2c00a2be8?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxzZWFyY2h8NDN8fHJhbWVufGVufDB8MHwwfHw%3D&auto=format&fit=crop&w=500&q=60"
          height="200px"
          ></v-img>

          <v-card-title>
            <h2>叉燒雞白湯拉麵</h2>
          </v-card-title>

      <v-card-text class="mx-auto justify-center d-flex flex-column align-center">
        <h3>肉食雙響炮</h3>
      </v-card-text>

  </v-card>
      </v-col>
    </v-row>
  </v-container>
  </v-app>
</template>

<script>

export default {
  name: 'Menu',
  data () {
    return {
    }
  },
  components: {
  }
}
</script>

```
---
# 寫前端(Register.vue)
```html
<template>
<v-app>
  <v-form v-model="valid" class="mb-5" ref="form" lazy-validation @submit.prevent="register">
      <v-container style="background-color:rgb(253, 236, 0);height: 800px;padding-top: 100px;">
        <v-row class="flex-column align-center mt-5">
            <v-col cols="12" md="4">
                <v-text-field
                  v-model="form.account"
                  :rules="accountRules"
                  :counter="10"
                  label="帳號"
                  required
                ></v-text-field>
            </v-col>

            <v-col cols="12" md="4">
                <v-text-field
                    v-model="form.password"
                    :rules="passwordRules"
                    counter="10"
                    label="密碼"
                    required
                    :append-icon="show ? 'mdi-eye' : 'mdi-eye-off'"
                    :type="show ? 'text' : 'password'"
                    @click:append="show = !show"
                ></v-text-field>
            </v-col>

            <v-col cols="12" md="4">
                <v-text-field
                  v-model="form.email"
                  :rules="emailRules"
                  label="E-mail"
                  required
                ></v-text-field>
            </v-col>
            <v-col cols="12" md="4" class="d-flex justify-center mt-5">
                <v-btn style="font-size: 20px;font-weight: 600;color: white;" large color="red" type="submit" @click="accountvalidate">註冊</v-btn>
            </v-col>
        </v-row>
    </v-container>
  </v-form>
</v-app>
</template>

<script>

export default {
  name: 'Register',
  data: () => ({
    form: {
      account: '',
      password: '',
      email: ''
    },
    valid: true,
    account: '',
    accountRules: [
      v => !!v || '帳號必填',
      v => v.length <= 10 || '帳號最多十個字',
      v => v.length >= 4 || '帳號最少四個字'
    ],
    password: '',
    passwordRules: [
      v => !!v || '密碼必填',
      v => v.length >= 4 || '密碼最少四個字'
    ],
    email: '',
    emailRules: [
      v => !!v || 'E-mail is required',
      v => /.+@.+/.test(v) || 'E-mail must be valid'
    ],
    show: false
  }),
  methods: {
    accountvalidate () {
      this.$refs.form.validate()
    },
    async register () {
      const valid = this.$refs.form.validate()
      if (!valid) return
      try {
        await this.api.post('/users', this.form)
        this.$swal({
          icon: 'success',
          title: '成功',
          text: '註冊成功'
        })
        this.$router.push('/')
      } catch (error) {
        this.$swal({
          icon: 'error',
          title: '錯誤',
          text: error.response.data.message
        })
      }
    }
  }
}
</script>

```
# 創plugins/axios.js
### https://www.npmjs.com/package/vue-axios(npm引入方法)
```js
import Vue from 'vue'
import axios from 'axios'
import VueAxios from 'vue-axios'

const api = axios.create({
  baseURL: process.env.VUE_APP_API
})

Vue.use(VueAxios, { axios, api })
```
## main.js裡面引入(寫在bootstrap-vue下方)
    import './plugins/axios.js'
## Register.vue
## 加上
```js
<v-form v-model="valid" class="mb-5" ref="form" lazy-validation @submit.prevent="register">
async register () {
      const valid = this.$refs.form.validate()
      if (!valid) return
      try {
        await this.api.post("/users", this.form)
        this.$swal({
          icon: 'success',
          title: '成功',
          text: '註冊成功'
        })
        this.$router.push('/')
      } catch (error) {
        this.$swal({
          icon: 'error',
          title: '錯誤',
          text: error.response.data.message
        })
      }
    }
```
## 引入sweetalert2 到main.js
### (npm:https://www.npmjs.com/package/vue-sweetalert2)
```js
// import Vue from 'vue';
// import store from './store' 寫在這個下
import VueSweetalert2 from 'vue-sweetalert2'
import 'sweetalert2/dist/sweetalert2.min.css'

Vue.use(VueSweetalert2)
// Vue.config.productionTip = false 寫在這個上
```
## Register.vue 增加
```js
methods: {
    async register () {
      try {
        await this.api.post('/users', this.form)
        this.$swal({
          icon: 'success',
          title: '成功',
          text: '註冊成功'
        })
        this.$router.push('/')
      } catch (error) {
        this.$swal({
          icon: 'error',
          title: '錯誤',
          text: error.response.data.message
        })
      }
    }
  }
```
## 建立.env.local
    VUE_APP_API=http://localhost:3000
### 後端 npm run dev 
### 後端記得改env，final1
### 前端 npm run serve
### 選localhost的網址打開VUE
### 可以先註冊admin，管理者
### 就可以把資料註冊傳入成功
### 可以看資料庫有沒有成功
---
# 03:33:33 做後端，登入的後台
## 創資料夾middleware/content.js
```js
export default (contentType) => {
  return (req, res, next) => {
    if (!req.headers['content-type'] || !req.headers['content-type'].includes(contentType)) {
      res.status(400).send({ success: false, message: '資料格式不正確' })
    } else {
      next()
    }
  }
}
```
## 路由routes/users.js
```js

import express from 'express'
import content from '../middleware/content.js'

import {
  register,
  login
} from '../controllers/users.js'

const router = express.Router()

router.post('/', content('application/json'), register)
router.post('/login', content('application/json'), login)

export default router
```
## 寫功能controllers/users.js
```js
import md5 from 'md5'
import jwt from 'jsonwebtoken'
import users from '../models/users.js'

export const register = async (req, res) => {
  try {
    await users.create(req.body)
    res.status(200).send({ success: true, message: '' })
  } catch (error) {
    if (error.name === 'ValidationError') {
      const key = Object.keys(error.errors)[0]
      res.status(400).send({ success: false, message: error.errors[key].message })
    } else if (error.name === 'MongoServerError' && error.code === 11000) {
      res.status(400).send({ success: false, message: '帳號已存在' })
    } else {
      res.status(500).send({ success: false, message: '伺服器錯誤' })
    }
  }
}

export const login = async (req, res) => {
  try {
    const user = await users.findOne(
      { account: req.body.account, password: md5(req.body.password) },
      '-password'
    )
    if (user) {
      const token = jwt.sign({ _id: user._id.toString() }, process.env.SECRET, { expiresIn: '7 days' })
      user.tokens.push(token)
      await user.save()
      const result = user.toObject()
      delete result.tokens
      result.token = token
      res.status(200).send({ success: true, message: '', result })
    } else {
      res.status(404).send({ success: false, message: '帳號或密碼錯誤' })
    }
  } catch (error) {
    res.status(500).send({ success: false, message: '伺服器錯誤' })
  }
}

export const logout = async (req, res) => {
  try {
    req.user.tokens = req.user.tokens.filter(token => token !== req.token)
    await req.user.save()
    res.status(200).send({ success: true, message: '' })
  } catch (error) {
    res.status(500).send({ success: false, message: '伺服器錯誤' })
  }
}

export const extend = async (req, res) => {
  try {
    const idx = req.user.tokens.findIndex(token => token === req.token)
    const token = jwt.sign({ _id: req.user._id.toString() }, process.env.SECRET, { expiresIn: '7 days' })
    req.user.tokens[idx] = token
    req.user.markModified('tokens')
    await req.user.save()
    res.status(200).send({ success: true, message: '', result: { token } })
  } catch (error) {
    res.status(500).send({ success: false, message: '伺服器錯誤' })
  }
}

export const getUserInfo = (req, res) => {
  try {
    const result = req.user.toObject()
    delete result.tokens
    res.status(200).send({ success: true, message: '', result })
  } catch (error) {
    res.status(500).send({ success: false, message: '伺服器錯誤' })
  }
}




```
## 創middleware/auth.js
```js
import jwt from 'jsonwebtoken'
import users from '../models/users.js'

export default async (req, res, next) => {
  try {
    // 短路求值家可選串聯(?.)，前面是undefined就是下一個
    const token = req.headers.authorization?.replace('Bearer ', '') || ''
    if (token.length > 0) {
      const decoded = jwt.decode(token)
      req.user = await users.findOne({ _id: decoded._id, tokens: token })
      req.token = token
      if (req.user) {
        jwt.verify(token, process.env.SECRET)
        next()
      } else {
        throw new Error()
      }
    } else {
      throw new Error()
    }
  } catch (error) {
    if (error.name === 'TokenExpiredError' && req.baseUrl === '/users' && req.path === '/extend') {
      next()
    } else {
      res.status(401).send({ success: false, message: '驗證錯誤' })
    }
  }
}
```
## 路由routes/users.js
```js
import express from 'express'
import content from '../middleware/content.js'
import auth from '../middleware/auth.js'

import {
  register,
  login,
  logout,
  extend,
  getUserInfo
} from '../controllers/users.js'

const router = express.Router()

router.post('/', content('application/json'), register)
router.post('/login', content('application/json'), login)
router.post('/extend', auth, extend)
router.delete('/logout', auth, logout)
router.get('/me', getUserInfo)

export default router
```
## .env
## 加SECRET
## SECRET=隨便打
## 改env 要重開 npm run dev
---
# 改寫前端
## store 改成module
## module好處，資料分開放
## 在store創user資料夾，裡面創五個
### actions.js
### getters.js
### index.js
### mutations.js
### state.js
---
## index.js
```js
import state from './state'
import * as actions from './actions'
import * as getters from './getters'
import * as mutations from './mutations'

export default {
  namespaced: true,
  state,
  actions,
  getters,
  mutations
}
```
## state.js
```js
export default () => {
  return {
    token: '',
    account: '',
    role: 0,
    email: '',
    cart: []
  }
}
```
## store/index.js
```js

import Vue from 'vue'
import Vuex from 'vuex'
import user from './user'

Vue.use(Vuex)

export default new Vuex.Store({
  state: {
  },
  mutations: {
  },
  actions: {
  },
  modules: {
    user
  }
})
```
---
## router/index.js
## 寫Login的路由
```js
{
    path: '/login',
    name: 'Login',
    component: () => import(/* webpackChunkName: "login" */ '../views/Login.vue'),
    meta: {
      title: '登入 | 購物網'
    }
  }
```
## router/index.js 專題路由
```js
import Vue from 'vue'
import VueRouter from 'vue-router'
import Home from '../views/Home.vue'

Vue.use(VueRouter)

const routes = [
  {
    path: '/',
    name: 'Home',
    component: Home,
    meta: {
      title: '麵屋號'
    }
  },
  {
    path: '/about',
    name: 'About',
    // route level code-splitting
    // this generates a separate chunk (about.[hash].js) for this route
    // which is lazy-loaded when the route is visited.
    component: () => import(/* webpackChunkName: "about" */ '../views/About.vue'),
    meta: {
      title: '麵屋號 | 品牌介紹'
    }
  },
  {
    path: '/shop',
    name: 'Shop',
    // route level code-splitting
    // this generates a separate chunk (about.[hash].js) for this route
    // which is lazy-loaded when the route is visited.
    component: () => import(/* webpackChunkName: "shop" */ '../views/Shop.vue'),
    meta: {
      title: '麵屋號 | 網路商城'
    }
  },
  {
    path: '/product',
    name: 'Product',
    // route level code-splitting
    // this generates a separate chunk (about.[hash].js) for this route
    // which is lazy-loaded when the route is visited.
    component: () => import(/* webpackChunkName: "product" */ '../views/Product.vue'),
    meta: {
      title: '麵屋號 | 商品'
    }
  },
  {
    path: '/menu',
    name: 'Menu',
    // route level code-splitting
    // this generates a separate chunk (about.[hash].js) for this route
    // which is lazy-loaded when the route is visited.
    component: () => import(/* webpackChunkName: "menu" */ '../views/Menu.vue'),
    meta: {
      title: '麵屋號 | 菜單'
    }
  },
  {
    path: '/login',
    name: 'Login',
    // route level code-splitting
    // this generates a separate chunk (about.[hash].js) for this route
    // which is lazy-loaded when the route is visited.
    component: () => import(/* webpackChunkName: "login" */ '../views/Login.vue'),
    meta: {
      title: '麵屋號 | 登入'
    }
  },
  {
    path: '/register',
    name: 'Register',
    // route level code-splitting
    // this generates a separate chunk (about.[hash].js) for this route
    // which is lazy-loaded when the route is visited.
    component: () => import(/* webpackChunkName: "register" */ '../views/Register.vue'),
    meta: {
      title: '麵屋號 | 註冊'
    }
  },
  {
    path: '/cart',
    name: 'Cart',
    // route level code-splitting
    // this generates a separate chunk (about.[hash].js) for this route
    // which is lazy-loaded when the route is visited.
    component: () => import(/* webpackChunkName: "cart" */ '../views/Cart.vue'),
    meta: {
      title: '麵屋號 | 購物車'
    }
  }
]

const router = new VueRouter({
  routes
})

router.afterEach((to, from) => {
  document.title = to.meta.title
})

export default router
```
## App.vue 加 to
```html
<v-tab to="/login"><h2>登入</h2></v-tab>
```
## 創 views/Login.vue
```html
<template>
<v-app>
  <v-form v-model="valid" class="mb-5" ref="form" lazy-validation @submit.prevent="login">
      <v-container style="background-color:rgb(253, 236, 0);height: 800px;padding-top: 100px;">
        <v-row class="flex-column align-center mt-5">
            <v-col cols="12" md="4">
                <v-text-field
                  v-model="form.account"
                  :rules="accountRules"
                  :counter="10"
                  label="帳號"
                  required
                ></v-text-field>
            </v-col>

            <v-col cols="12" md="4">
                <v-text-field
                    v-model="form.password"
                    :rules="passwordRules"
                    counter="10"
                    label="密碼"
                    required
                    :append-icon="show ? 'mdi-eye' : 'mdi-eye-off'"
                    :type="show ? 'text' : 'password'"
                    @click:append="show = !show"
                ></v-text-field>
            </v-col>

            <v-col cols="12" md="4" class="d-flex justify-center mt-5">
                <v-btn style="font-size: 20px;font-weight: 600;color: white;" large color="red" type="submit" @click="accountvalidate">登入</v-btn>
            </v-col>
        </v-row>
    </v-container>
  </v-form>
</v-app>
</template>

<script>

export default {
  name: 'Login',
  data: () => ({
    form: {
      account: '',
      password: ''
    },
    valid: true,
    account: '',
    accountRules: [
      v => !!v || '帳號必填',
      v => v.length <= 10 || '帳號最多十個字',
      v => v.length >= 4 || '帳號最少四個字'
    ],
    password: '',
    passwordRules: [
      v => !!v || '密碼必填',
      v => v.length >= 4 || '密碼最少四個字'
    ],
    show: false
  }),
  methods: {
    accountvalidate () {
      this.$refs.form.validate()
    },
    // 這種寫法，非同步放在actions.js裡，不能放在mutations.js裡
    // actions要改state一樣要commit呼叫mutations去改state
    login () {
      // .dispatch() 是呼叫actions.js
      // 外層要加module的名稱，user/login
      this.$store.dispatch('user/login', this.form)
    }
  }
}
</script>

```
## 登入頁要做的事
## 把帳號密碼送給後台，送過去後，把後臺回給前台的使用者的資料，塞進 VueX 裡面
## store/user/actions.js，被dispatch呼叫
```js
import { api } from '@/plugins/axios.js'
import swal from 'sweetalert2'
import router from '@/router'
// @/代表src資料夾

// { commit }解構 是 VueX的commit， VueX的用法，VueX的content有很多用法
export const login = async ({ commit }, form) => {
  try {
    // 在VueX這時不能用this.api會找不到，所以要引入api
    const { data } = await api.post('/users/login', form)
    // 在module裡面時，不需要寫user/login
    commit('login', data.result)
    router.push('/')
    swal.fire({
      icon: 'success',
      title: '成功',
      text: '登入成功'
    })
  } catch (error) {
    swal.fire({
      icon: 'error',
      title: '失敗',
      text: error.response.data.message
    })
  }
}
```
## axios.js 要 export api
```js
// 加export
export const api = axios.create({
  baseURL: process.env.VUE_APP_API
})
```
## store/user/mutations.js，寫被commit呼叫的login
```js
// state = user module 的 state
// this.state = vuex root state
// this.state.module名 = 其他 module 的 state
export const login = (state, data) => {
  state.token = data.token
  state.account = data.account
  state.role = data.role
  state.email = data.email
  state.cart = data.cart
}
```
## 這樣的寫法是把使用者有關的資料都放在VueX裡，外層只要呼叫就好了
## 非同步放在actions.js裡，不能放在mutations.js裡
## actions要改state一樣要commit呼叫mutations去改state
## commit呼叫是mutations.js
## dispatch呼叫是actions.js
## 可以開頁面登入測試看看
## 後端 npm run dev，前端 npm run serve 去登入看看
## VueX有資料，就是登入成功了
---
# 寫getters.js
## getters.js 就是去取VueX的資料可以先經過一些運算再把資料丟出去
## 可以拿來做判斷，例如帳號的length>0就是登入，或是state.role===1就是admin
### 外部取資料就可以簡單一點，this.$store.getters['user/user'].isLogin
```js
export const user = (state) => {
  return {
    isLogin: state.account.length > 0,
    isAdmin: state.role === 1,
    ...state
  }
}
```
---
## 去APP.vue 寫會用到getters資料的東西
## 要取VueX的資料要用computed
# App.vue
## 寫登入狀態要顯示什麼(取getters資料)
## v-if="!user.isLogin"
```html
        <v-tab v-if="!user.isLogin" to="/register"><h2>註冊</h2></v-tab>
        <v-tab v-if="!user.isLogin" to="/login"><h2>登入</h2></v-tab>
        <v-tab v-if="user.isLogin"><h2>登出</h2></v-tab>
```
```js
export default {
  // VueX的資料要用computed去取
  computed: {
    user () {
      // 取getters的資料方法，這樣取資料就可以寫user.Login
      return this.$store.getters['user/user']
    }
  }
}
```
---
## 在App.vue寫登出功能
```html
<v-tab v-if="user.isLogin" @click="logout"><h2>登出</h2></v-tab>
<script>
import Footer from './components/Footer.vue'
export default {
  name: 'App',
  components: {
    Footer
  },
  // VueX的資料要用computed去取
  computed: {
    user () {
      // 取getters的資料方法，這樣取資料就可以寫user.Login
      return this.$store.getters['user/user']
    }
  },
  methods: {
    // 登出就是把VueX的資料刪掉，要用非同步，
    // 透過dispatch actions去commit mutations 改 state
    logout () {
      this.$store.dispatch('user/logout')
    }
  }
}
</script>
```
## 寫actions.js的logout
```js
export const logout = async ({ commit, state }) => {
  try {
    // 要傳jwt進去
    await api.delete('/users/logout', {
      headers: {
        authorization: 'Bearer ' + state.token
      }
    })
    commit('logout')
    router.push('/')
    swal.fire({
      icon: 'success',
      title: '成功',
      text: '登出成功'
    })
  } catch (error) {
    swal.fire({
      icon: 'error',
      title: '失敗',
      text: error.response.data.message
    })
  }
}
```
## 在寫mutations.js，被commit的logout
```js
export const logout = (state, data) => {
  state.token = ''
  state.account = ''
  state.role = 0
  state.email = ''
  state.cart = []
}
```
# 就可以前後端打開，登入登出
---
## 新增mixin.js
## 如果元件有共通的data、methods跟computed
## 在跟main.js同層，開一個mixin.js
## 把App.vue，可能會跟其他元件共通的，例如computed的user剪下
```js
// VueX的資料要用computed去取
  computed: {
    user () {
      // 取getters的資料方法，這樣取資料就可以寫user.Login
      return this.$store.getters['user/user']
    }
  },
```
## App.vue
```html
<template >
<v-app>
  <v-app-bar color="red" height="110">
    <router-link class="logo" to="/">
      <div class="navbar_logo">
      <img src="~./assets/logo_nav.png"  alt="logo" contain height="100"/>
      </div>
    </router-link>
    <template>
      <v-tabs
      background-color="deep-red"
      center-active
      centered
      dark
      >
        <v-tab  to="/"><h2>首頁</h2></v-tab>
        <v-tab  to="/about"><h2>品牌介紹</h2></v-tab>
        <v-tab to="/menu"><h2>菜單</h2></v-tab>
        <v-tab to="/shop"><h2>網路商城</h2></v-tab>
        <v-tab to="/product"><h2>商品</h2></v-tab>
        <v-tab v-if="!user.isLogin" to="/register"><h2>註冊</h2></v-tab>
        <v-tab v-if="!user.isLogin" to="/login"><h2>登入</h2></v-tab>
        <v-tab v-if="user.isLogin" @click="logout"><h2>登出</h2></v-tab>
        <v-tab to="/cart"><h2>購物車</h2></v-tab>
      </v-tabs>
    </template>
  </v-app-bar>
  <router-view></router-view>
  <Footer></Footer>
</v-app>
</template>

<script>
import Footer from './components/Footer.vue'
export default {
  name: 'App',
  components: {
    Footer
  },
  methods: {
    // 登出就是把VueX的資料刪掉，要用非同步，
    // 透過dispatch actions去commit mutations 改 state
    logout () {
      this.$store.dispatch('user/logout')
    }
  }
}
</script>

```
## mixin.js
```js
export default {
// VueX的資料要用computed去取
  computed: {
    user () {
    // 取getters的資料方法，這樣取資料就可以寫user.Login
      return this.$store.getters['user/user']
    }
  }
}

```
## 要import到main.js
## 這樣每一個元件都可以有computed的user可以用
### 開啟網頁的F12的Vue，每個元件都有computed的user
### 這個方法是每個都可以用mixin，也可以個別引用到元件
```js
import mixin from './mixin.js'
Vue.mixin(mixin)
```
# main.js全部
```js
import Vue from 'vue'
import App from './App.vue'
import './registerServiceWorker'
import router from './router'
import store from './store'
import vuetify from './plugins/vuetify'
import './plugins/axios.js'
import VueSweetalert2 from 'vue-sweetalert2'
import 'sweetalert2/dist/sweetalert2.min.css'
import './style/all.scss'
import mixin from './mixin.js'

Vue.use(VueSweetalert2)
Vue.mixin(mixin)

Vue.config.productionTip = false

new Vue({
  router,
  store,
  vuetify,
  render: h => h(App)
}).$mount('#app')

```
# 0103教的內容，0221，0222寫的時間
---
# 0110開始